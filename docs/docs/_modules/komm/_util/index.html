
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>komm._util &#8212; Komm 0.7.4 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../../genindex/" />
    <link rel="search" title="Search" href="../../../search/" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../">Komm 0.7.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">komm._util</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for komm._util</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">special</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;binlist2int&quot;</span><span class="p">,</span>
    <span class="s2">&quot;int2binlist&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pack&quot;</span><span class="p">,</span>
    <span class="s2">&quot;unpack&quot;</span><span class="p">,</span>
    <span class="s2">&quot;qfunc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;qfuncinv&quot;</span><span class="p">,</span>
    <span class="s2">&quot;entropy&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="c1"># Functions beginning with underscore:</span>
<span class="c1"># - Should not be used by the end user.</span>
<span class="c1"># - Should be as fast as possible.</span>
<span class="c1"># - May have assumptions on the input and on the output</span>
<span class="c1">#   (e.g., may assume the input is a list, or a numpy array, etc.).</span>
<span class="c1">#</span>
<span class="c1"># Functions without underscore:</span>
<span class="c1"># - Are available to the end user.</span>
<span class="c1"># - Should work when the input is a list, a numpy array, etc.</span>
<span class="c1"># - Should check the input whenever possible.</span>
<span class="c1"># - Should return a numpy array (instead of a list) whenever possible.</span>

<span class="c1"># TODO: Rename binlist2int and int2binlist to something better.</span>
<span class="c1"># TODO: Vectorize those functions (e.g., axis=1).</span>


<span class="k">def</span> <span class="nf">_binlist2int</span><span class="p">(</span><span class="n">list_</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span> <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>


<div class="viewcode-block" id="binlist2int"><a class="viewcode-back" href="../../../komm.binlist2int/#komm.binlist2int">[docs]</a><span class="k">def</span> <span class="nf">binlist2int</span><span class="p">(</span><span class="n">list_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a bit array to its integer representation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_binlist2int</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_int2binlist</span><span class="p">(</span><span class="n">int_</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">int_</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[(</span><span class="n">int_</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">width</span><span class="p">)]</span>


<div class="viewcode-block" id="int2binlist"><a class="viewcode-back" href="../../../komm.int2binlist/#komm.int2binlist">[docs]</a><span class="k">def</span> <span class="nf">int2binlist</span><span class="p">(</span><span class="n">int_</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts an integer to its bit array representation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_int2binlist</span><span class="p">(</span><span class="n">int_</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span></div>


<span class="k">def</span> <span class="nf">_pack</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">_binlist2int</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">newshape</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="p">)))</span>


<div class="viewcode-block" id="pack"><a class="viewcode-back" href="../../../komm.pack/#komm.pack">[docs]</a><span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Packs a given integer array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_pack</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_unpack</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">([</span><span class="n">_int2binlist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">list_</span><span class="p">])</span>


<div class="viewcode-block" id="unpack"><a class="viewcode-back" href="../../../komm.unpack/#komm.unpack">[docs]</a><span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unpacks a given bit array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_unpack</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_qfunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">erfc</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>


<div class="viewcode-block" id="qfunc"><a class="viewcode-back" href="../../../komm.qfunc/#komm.qfunc">[docs]</a><span class="k">def</span> <span class="nf">qfunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the Gaussian Q-function. It is given by</span>

<span class="sd">    .. math::</span>

<span class="sd">       \\mathrm{Q}(x) = \\frac{1}{\\sqrt{2\\pi}} \\int_x^\\infty \\mathrm{e}^{-u^2/2} \\, \\mathrm{d}u.</span>

<span class="sd">    .. rubric:: Input</span>

<span class="sd">    :code:`x` : :obj:`float` or array of :obj:`float`</span>
<span class="sd">        The input to the function. May be any float or array of floats.</span>

<span class="sd">    .. rubric:: Output</span>

<span class="sd">    :code:`y` : same as input</span>
<span class="sd">        The value :math:`y = \\mathrm{Q}(x)`.</span>

<span class="sd">    .. rubric:: Examples</span>

<span class="sd">    &gt;&gt;&gt; komm.qfunc(0.0)</span>
<span class="sd">    0.5</span>

<span class="sd">    &gt;&gt;&gt; komm.qfunc([-1.0, 0.0, 1.0])</span>
<span class="sd">    array([0.84134475, 0.5       , 0.15865525])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_qfunc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_qfuncinv</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">erfcinv</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>


<div class="viewcode-block" id="qfuncinv"><a class="viewcode-back" href="../../../komm.qfuncinv/#komm.qfuncinv">[docs]</a><span class="k">def</span> <span class="nf">qfuncinv</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the inverse Gaussian Q-function.</span>

<span class="sd">    .. rubric:: Input</span>

<span class="sd">    :code:`y` : :obj:`float` or array of :obj:`float`</span>
<span class="sd">        The input to the function. Should be a float or array of floats in the real interval :math:`[0, 1]`.</span>

<span class="sd">    .. rubric:: Output</span>

<span class="sd">    :code:`x` : same as input</span>
<span class="sd">        The value :math:`x = \\mathrm{Q^{-1}}(y)`.</span>

<span class="sd">    &gt;&gt;&gt; komm.qfuncinv(0.5)  #doctest:+SKIP</span>
<span class="sd">    0.0</span>

<span class="sd">    &gt;&gt;&gt; komm.qfuncinv([0.841344746, 0.5, 0.158655254])  #doctest:+SKIP</span>
<span class="sd">    array([-1., 0.,  1.])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_qfuncinv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></div>


<span class="k">def</span> <span class="nf">_entropy_base_e</span><span class="p">(</span><span class="n">pmf</span><span class="p">):</span>
    <span class="c1"># Assumptions:</span>
    <span class="c1"># - pmf is a 1D numpy array.</span>
    <span class="c1"># - pmf is a valid pmf.</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pmf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pmf</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">pmf</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">_entropy_base_2</span><span class="p">(</span><span class="n">pmf</span><span class="p">):</span>
    <span class="c1"># Assumptions: Same as _entropy_base_e.</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">pmf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">pmf</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">pmf</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="n">pmf</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
    <span class="c1"># Assumptions: Same as _entropy_base_e.</span>
    <span class="k">if</span> <span class="n">base</span> <span class="o">==</span> <span class="s2">&quot;e&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_entropy_base_e</span><span class="p">(</span><span class="n">pmf</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">base</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_entropy_base_2</span><span class="p">(</span><span class="n">pmf</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_entropy_base_e</span><span class="p">(</span><span class="n">pmf</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>


<div class="viewcode-block" id="entropy"><a class="viewcode-back" href="../../../komm.entropy/#komm.entropy">[docs]</a><span class="k">def</span> <span class="nf">entropy</span><span class="p">(</span><span class="n">pmf</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the entropy of a random variable with a given :term:`pmf`. Let :math:`X` be a random variable with :term:`pmf` :math:`p_X` and alphabet :math:`\\mathcal{X}`. Its entropy is given by</span>

<span class="sd">    .. math::</span>

<span class="sd">       \\mathrm{H}(X) = \\sum_{x \\in \\mathcal{X}} p_X(x) \\log \\frac{1}{p_X(x)},</span>

<span class="sd">    By default, the base of the logarithm is :math:`2`, in which case the entropy is measured in bits.</span>

<span class="sd">    References: :cite:`Cover.Thomas.06` (Ch. 2)</span>

<span class="sd">    .. rubric:: Input</span>

<span class="sd">    :code:`pmf` : 1D-array of :obj:`float`</span>
<span class="sd">        The probability mass function :math:`p_X` of the random variable. It must be a valid :term:`pmf`, that is, all of its values must be non-negative and sum up to :math:`1`.</span>

<span class="sd">    :code:`base` : :obj:`float` or :obj:`str`, optional</span>
<span class="sd">        The base of the logarithm to be used. It must be a positive float or the string :code:`&#39;e&#39;`. The default value is :code:`2.0`.</span>

<span class="sd">    .. rubric:: Output</span>

<span class="sd">    :code:`entropy` : :obj:`float`</span>
<span class="sd">        The entropy :math:`\\mathrm{H}(X)` of the random variable.</span>

<span class="sd">    .. rubric:: Examples</span>

<span class="sd">    &gt;&gt;&gt; komm.entropy([1/4, 1/4, 1/4, 1/4])</span>
<span class="sd">    2.0</span>

<span class="sd">    &gt;&gt;&gt; komm.entropy([1/3, 1/3, 1/3], base=3.0)  #doctest:+SKIP</span>
<span class="sd">    1.0</span>

<span class="sd">    &gt;&gt;&gt; komm.entropy([1.0, 1.0])</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">     ...</span>
<span class="sd">    ValueError: Invalid pmf</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pmf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pmf</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pmf</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">alltrue</span><span class="p">(</span><span class="n">pmf</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid pmf&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_entropy</span><span class="p">(</span><span class="n">pmf</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_mutual_information</span><span class="p">(</span><span class="n">input_pmf</span><span class="p">,</span> <span class="n">transition_probabilities</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span>
    <span class="n">output_pmf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">input_pmf</span><span class="p">,</span> <span class="n">transition_probabilities</span><span class="p">)</span>
    <span class="n">entropy_output_prior</span> <span class="o">=</span> <span class="n">_entropy</span><span class="p">(</span><span class="n">output_pmf</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">)</span>
    <span class="n">entropy_base</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">pmf</span><span class="p">:</span> <span class="n">_entropy</span><span class="p">(</span><span class="n">pmf</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">)</span>
    <span class="n">entropy_output_posterior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">input_pmf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">entropy_base</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">transition_probabilities</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">entropy_output_prior</span> <span class="o">-</span> <span class="n">entropy_output_posterior</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Library reference</h3>
<ul>
    <li><a class="reference internal" href="../../../#algebra">Algebra</a></li>
    <li><a class="reference internal" href="../../../#channels">Channels</a></li>
    <li><a class="reference internal" href="../../../#error-control">Error control</a></li>
    <li><a class="reference internal" href="../../../#finite-state-machine">Finite-state machine</a></li>
    <li><a class="reference internal" href="../../../#modulation">Modulation</a></li>
    <li><a class="reference internal" href="../../../#pulse-formatting">Pulse formatting</a></li>
    <li><a class="reference internal" href="../../../#quantization">Quantization</a></li>
    <li><a class="reference internal" href="../../../#sequences">Sequences</a></li>
    <li><a class="reference internal" href="../../../#source-coding">Source coding</a></li>
    <li><a class="reference internal" href="../../../#utilities">Utilities</a></li>
</ul><h3>Indices</h3>
<ul>
    <li><a class="reference internal" href="../../../glossary/">Glossary</a></li>
    <li><a class="reference internal" href="../../../references/">References</a></li>
    <li><a class="reference internal" href="../../../genindex/">Index</a></li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex/" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../../">Komm 0.7.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">komm._util</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018–2023, Roberto W. Nobrega.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    </div>
  </body>
</html>